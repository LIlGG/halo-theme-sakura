import{d as y,s as c}from"../main-2.4.3.min.js";import"../assets/_commonjsHelpers-042e6b4d.js";class E{static async like(o,t,e){const n=await fetch("/apis/api.halo.run/v1alpha1/trackers/upvote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:o,plural:t,name:e})});if(n.status!==200){console.error("点赞失败，请求异常");return}return n}}var C=Object.defineProperty,k=Object.getOwnPropertyDescriptor,S=(a,o,t,e)=>{for(var n=e>1?void 0:e?k(o,t):o,r=a.length-1,s;r>=0;r--)(s=a[r])&&(n=(e?s(o,t,n):s(n))||n);return e&&n&&C(o,t,n),n};class L{registerMomentListPagination(){const o=document.getElementById("moment-list-pagination");if(!o)return;const t=o.querySelector("a");t&&t.addEventListener("click",e=>{e.preventDefault();const n=document.querySelector(".moments-container .moments-inner");if(!n)return;const r=e.target,s=r.href;r.classList.add("loading"),r.textContent="",fetch(s,{method:"GET"}).then(m=>m.text()).then(m=>{const d=new DOMParser().parseFromString(m,"text/html"),f=d.querySelector(".moments-container .moments-inner");if(f){const l=f.querySelectorAll(".moments-item");l&&l.length>0&&l.forEach(h=>{n.appendChild(h);const i=h.querySelector(".comment-box .comment script:last-of-type");if(i){const v=i.text||i.textContent||i.innerHTML||"",u=i.parentNode;if(u){u.removeChild(i);const p=document.createElement("script");p.type="text/javascript",p.appendChild(document.createTextNode(v)),u.appendChild(p)}}})}const g=d.querySelector("#moment-list-pagination a");g?r.href=g.href:o.innerHTML="",c.refresh()}).catch(m=>{console.error(m)}).finally(()=>{r.classList.remove("loading"),r.textContent=c.translate("page.moments.loadmore","加载更多..."),c.$localize&&c.$localize(".moments-inner")})})}registerMomentItem(o){const t=o||document.querySelector(".moments-container .moments-inner");if(!t)return;const e=t==null?void 0:t.querySelectorAll(".moments-item");!e||e.length<=0||e.forEach(n=>{this.registerMomentItemLike(n),this.registerMomentItemComment(n)})}registerMomentItemLike(o){const t=JSON.parse(localStorage.getItem("momentlikedIds")||"[]"),e=o.querySelector(".moment-tools .moment-like");if(!e)return;const n=o.getAttribute("data-name")||"";if(t&&(t!=null&&t.includes(n))){e.classList.add("on");return}e.addEventListener("click",()=>{let r=Number(e.getAttribute("data-links")||"0");E.like("moment.halo.run","moments",n).then(()=>{r+=1,t.push(n),e.classList.add("on"),e.setAttribute("data-links",r.toString());const s=e.querySelector(".moment-like-text");s&&(s.textContent=r.toString()),localStorage.setItem("momentlikedIds",JSON.stringify(t))})},{once:!0})}registerMomentItemComment(o){const t=o.querySelector(".moment-tools .comment-js");t&&t.addEventListener("click",()=>{const e=o.querySelector(".comment-box");e==null||e.classList.toggle("is-show")})}}S([y(!1)],L.prototype,"registerMomentListPagination",1);S([y()],L.prototype,"registerMomentItem",1);
