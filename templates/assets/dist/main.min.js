var g=Object.defineProperty;var m=(n,e,t)=>e in n?g(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var o=(n,e,t)=>(m(n,typeof e!="symbol"?e+"":e,t),t);var F=Object.defineProperty,l=Object.getOwnPropertyDescriptor,E=(n,e,t,i)=>{for(var s=i>1?void 0:i?l(e,t):e,c=n.length-1,u;c>=0;c--)(u=n[c])&&(s=(i?u(e,t,s):u(s))||s);return i&&s&&F(e,t,s),s};class d{registerTabsTag(){console.log(a)}}E([D()],d.prototype,"registerTabsTag",1);class h{constructor(e){o(this,"schemas");this.schemas=e}isEmpty(){return!this.schemas}getValue(e,t){if(!this.isEmpty()&&e.toString()in this.schemas)return new t(this.schemas.key)}}class f{constructor(){o(this,"documentFunctions");this.documentFunctions=new Map}geDocumentFunctionCount(){return this.documentFunctions.size}getDocumentFunctions(){return this.documentFunctions}getDocumentFunctionNames(){return this.documentFunctions.size===0?new Set:this.documentFunctions.keys()}registerDocumentFunction(e,t){this.documentFunctions.set(e,t)}getDocumentFunction(e){if(this.documentFunctions.has(e))return this.documentFunctions.get(e)}}class v{constructor(e){o(this,"config");o(this,"themeconfigs");o(this,"startupDate",new Date);o(this,"documentFunctionFactory",new f);o(this,"events",new Map);o(this,"REFRESH_EVENT_NAME","sakura:refresh");this.config=e,this.themeconfigs=new Map,this.createThemeConfig()}createThemeConfig(){if(!this.config)return;let e=JSON.parse(this.config.toString());Object.keys(e).forEach(t=>{let i=new h(e[t]);this.themeconfigs.set(t,i)})}getThemeConfig(e){let t=this.themeconfigs.get(e);return t||new h}refresh(){this.prepareRefresh();let e=this.obtainFunctionFactory();this.registerDomProcessors(e),this.initEventMulticaster(),this.finishDocumentFunction(e),this.finishRefresh()}finishDocumentFunction(e){let t=e.getDocumentFunctions();for(let[i,s]of t)s()}obtainFunctionFactory(){return this.documentFunctionFactory||(this.documentFunctionFactory=new f),this.documentFunctionFactory}prepareRefresh(){this.startupDate=new Date,this.getThemeConfig("advanced").getValue("log",Boolean)&&console.log("Sakura Refreshing"),this.refreshMetadata()}refreshMetadata(){}registerDomProcessors(e){p().forEach((i,s)=>{e.registerDocumentFunction(s,i)}),this.getThemeConfig("advanced").getValue("log",Boolean)&&console.log("共获取预设 documentFunction "+e.geDocumentFunctionCount()+" 个")}initEventMulticaster(){let e=this.events.get(this.REFRESH_EVENT_NAME);e||(e=new CustomEvent(this.REFRESH_EVENT_NAME.toString()),this.events.set(this.REFRESH_EVENT_NAME,e))}finishRefresh(){let e=this.events.get(this.REFRESH_EVENT_NAME);window.dispatchEvent(e),this.getThemeConfig("advanced").getValue("log",Boolean)&&console.log("finish Refreshing")}}let a;document.addEventListener("DOMContentLoaded",()=>{a=new v(config),a.refresh()});var r;function p(){return r}function D(){return function(n,e,t){r||(r=new Map),r.set(e,n[e])}}window.addEventListener("sakura:refresh",()=>{console.log("event -> refresh")});export{a as s};
//# sourceMappingURL=main.min.js.map
